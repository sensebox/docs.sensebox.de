---
date: 2021-01-28
title: RTC-Modul
categories: hardware
description: Mit dem RTC-Modul kann die Uhrzeit auch ohne Stromversorgung gespeichert werden.
type: Document
resources:
  - name: "Shop"
    link: https://sensebox.kaufen/product/rtc-modul
image1: /images/2021-01-28-rtc-modul/rtc.png
---
Das RTC-Modul besitzt eine Echtzeituhr, die mit einer Batterie betrieben wird und daher unabhängig vom Mikrokontroller die Zeit speichern kann. Mit einer RTC können z.B. Langzeitmessungen mit Zeitstempeln versehen werden auch wenn keine permanente Internetverbindung vorhanden ist. Dies kann besonders nützlich sein, wenn keine Internetverbindung verfügbar ist und Messwerte offline z.B. auf der SD Karte gespeichert werden sollen. Die RTC wird mit einer 3V Knopfzelle mit Strom versorgt


{% include image.html image=page.image1 %}


## Anschluss

Lege die Knopfzellen mit der Beschriftung nach oben in die Halterung ein und schließe das RTC-Modul mit dem JST-JST Kabel an einen der 5 I2C Anschlüsse der senseBox MCU an. 


## Uhrzeit einrichten

Bevor du das RTC Modul verwendest, muss als Erstes die Anfangsuhrzeit gesetzt werden. Dies muss nur ein einziges Mal geschehen solange die Batterie wird nicht von dem Modul getrennt. In folgendem Sketch wird die Uhrzeit und das Datum im `setup` gesetzt und im `loop` auf dem seriellen Monitor ausgegeben. 
Denk dran, die aktuelle Zeit im `setup` beim Befehl `rtc.set(...)` selbst zu setzen. 

```arduino
#include <RV8523.h>
//#include <SenseBoxMCU.h> only use with blockly code and commend out senseBoxIO.h
#include <senseBoxIO.h>
#include <Wire.h>
#define BUFF_MAX 32

RV8523 rtc;
unsigned int recv_size = 0;
char recv[BUFF_MAX];

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  delay(200);
 
  Serial.println("Init RTC...");
  rtc.begin();
  rtc.start();
  rtc.set24HourMode(); 
  rtc.set(SECOND, MINUTE, HOUR, DAY, MONTH, YEAR); // Aktuelle Uhrzeit / Datum HIER setzen!
  rtc.batterySwitchOver(1);
}


void loop()
{
  uint8_t sec, min, hour, day, month;
  uint16_t year;

  //Uhrzeit befindet sich in den einzelnen Variablen !
  rtc.get(&sec, &min, &hour, &day, &month, &year);

  //serial output
  Serial.print("\nTime: ");
  Serial.print(hour, DEC);
  Serial.print(":");
  Serial.print(min, DEC);
  Serial.print(":");
  Serial.print(sec, DEC);

  Serial.print("\nDate: ");
  Serial.print(day, DEC);
  Serial.print(".");
  Serial.print(month, DEC);
  Serial.print(".");
  Serial.print(year, DEC);

  //wait a second
  delay(1000);
}
```

## Uhrzeit auslesen

Ist die Uhrzeit eingestellt worden kann die Uhrzeit ausgelesen werden. Die RTC startest du dann wie alle anderen I2C Sensoren auch. Achte bei der RTC nur darauf, dass du nicht aus Versehen den `rtc.set()` Befehl erneut aufrufst und somit die Uhrzeit wieder zurücksetzt. 

```arduino
#include <RV8523.h>
//#include <SenseBoxMCU.h> only use with blockly code and commend out senseBoxIO.h
#include <senseBoxIO.h>
#include <Wire.h>
#define BUFF_MAX 32

RV8523 rtc;
unsigned int recv_size = 0;
char recv[BUFF_MAX];

void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);

  Serial.println("Init RTC...");
  delay(200);
  rtc.begin();
  rtc.start();
  rtc.batterySwitchOver(1);

}
void loop()
{
  uint8_t sec, min, hour, day, month;
  uint16_t year;

  //Uhrzeit befindet sich in den einzelnen Variablen !
  rtc.get(&sec, &min, &hour, &day, &month, &year);

    //serial output
  Serial.print("\nTime: ");
  Serial.print(hour, DEC);
  Serial.print(":");
  Serial.print(min, DEC);
  Serial.print(":");
  Serial.print(sec, DEC);

  Serial.print("\nDate: ");
  Serial.print(day, DEC);
  Serial.print(".");
  Serial.print(month, DEC);
  Serial.print(".");
  Serial.print(year, DEC);
  //wait a second
  delay(1000);
}
```
## Programmierung über Blockly

Über Blockly kann die Uhrzeit der Batterie mit folgenden [Beispielprogramm](https://blockly-react.netlify.app/gallery/60c9c7dd1842740018c65bd0) eingestellt werden. Anschließend kannst du über die Blöcke in der Kategorie Zeit einen Zeitstempel oder einzelne Parameter der RTC auslesen.

